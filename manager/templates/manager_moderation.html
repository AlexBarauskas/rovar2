{% extends 'base_manager.html' %}

{% block inner_content %}
<h1>Объекты для модерирования</h1>
<p>
  <div>
    <label><input type="radio"{%if cur_state == 'm'%} checked="checked"{%endif%} name="state" value="m"/>Пступившие</label>
  </div>
  <div>
    <label><input type="radio"{%if cur_state == 'f'%} checked="checked"{%endif%} name="state" value="f"/>Рассмотренные</label>
  </div>
  <div>
    <label><input type="radio"{%if cur_state == 's'%} checked="checked"{%endif%} name="state" value="s"/>Уведомление отправлено клиенту</label>
  </div>
  <div>
    <label><input type="radio"{%if cur_state == 'r'%} checked="checked"{%endif%} name="state" value="r"/>Клиент получил уведомление</label>
  </div>
</p>
<ul class="filter-links">
  <li style="width:100px;padding:10px;float:left;text-align:center;"><a  style="cursor:pointer;text-decoration:none;color:#333;font-weight:bold;{%if cur_type == "all"%}color:orange;{%endif%}" href="{%url moderation_objects%}?state={{cur_state}}">All</a></li>
  {%for t in types%}
  <li style="width:100px;padding:10px;float:left;text-align:center;border-left:solid 1px"><a style="cursor:pointer;text-decoration:none;color:#333;font-weight:bold;{%if cur_type == t.slug%}color:orange;{%endif%}" href="{%url moderation_objects %}?type={{t.slug}}&state={{cur_state}}">{{t.name}}</a></li>
  {%endfor%}
  <li class="clear"></li>
</ul>

<table>
  <thead>
    <tr>
      <th>Метод</th>
      <th>Состояние нотификации</th>
      <th>Название</th>
      <th>Дата создания</th>
      <th>Тип</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    {% for obj in objects%}
    <tr>
      <td>{%if obj.method == 'a'%}Добавление{%else%}Изменение{%endif%}
      </td>
      <td>{{obj.state}}</td>
      {%if obj.point%}
      <td>{{obj.point.name}}</td>
      <td>{{obj.point.created}}</td>
      <td>{{obj.point.type}}</td>
      <td><a title="Редактировать информацию о пункту" class="icon-btn" href="{% url point-edit obj.point.id %}"><img src="/static/icons/edit.png"/></a></td>
      {%else%}
      <td>{{obj.track.name}}</td>
      <td>{{obj.track.created}}</td>
      <td>{{obj.track.type}}</td>
      <td><a title="Редактировать информацию о маршруте" class="icon-btn" href="{% url track-edit obj.track.id %}"><img src="/static/icons/edit.png"/></a></td>
      {%endif%}
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock inner_content %}

{% block js %}
<script type="text/javascript" src="/static/js/manager.js"></script>

  <script>
    $(function(){
    $('input[name="state"]').change(function(ev){
    var links = $('.filter-links a');
    for(var i=links.length-1;i>=0;i--){
    links[i].href = links[i].href.replace(/(state=\w)/gi, 'state='+this.value);
    }
    });
    });
  </script>
{% endblock js %}
